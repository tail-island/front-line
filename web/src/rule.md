# 戦線

[放課後さいころ倶楽部](https://gekkansunday.net/work/395/)の[3巻](https://shogakukan-comic.jp/book?isbn=9784091247681)で紹介されたボードゲームに似たルールのゲームをプレイするAIを作成してください。AI作成の際に対人でプレイしたい場合は、[バトルライン](https://www.amazon.co.jp/%E3%82%AF%E3%83%AD%E3%83%8E%E3%83%8E%E3%83%BC%E3%83%84%E3%82%B2%E3%83%BC%E3%83%A0-%E3%83%90%E3%83%88%E3%83%AB%E3%83%A9%E3%82%A4%E3%83%B3-%E6%97%A5%E6%9C%AC%E8%AA%9E%E7%89%88-2023/dp/B0C1VGBZG7/ref=sr_1_1)を購入してみてください。

![バトルライン](./images/battle-line.jpg)

## ルール

このゲームは2人で対戦します。互いの中央に、9つのフラッグが並んでいます。

![フラッグ](./images/9-flags.jpg)

ゲームの開始時にカードが7枚配られますので、その中から1枚選んでフラッグの前においてください。カードを置いた後、山札が残っていれば、山札からカードを1枚補充します。これでターンは終了。相手プレイヤーのターンになり、相手プレイヤーが手札からカードを1枚フラッグの前において、山札からカードを1枚補充します。

![カードを置く](./images/put-a-card.jpg)

フラッグの前にカードが3枚揃うと、役の成立です。役は「ストレート・フラッシュ」と「スリーカード」、「フラッシュ」、「ストレート」、「ブタ」の5種で、役の強さはこの順序の通りです（「ストレート・フラッシュ」が最も強く、「ブタ」が最も弱い）。

![役](./images/rank.jpg)

より強い役を成立させたプレイヤーがフラッグを獲得できます。役が同じ場合はカードの数字の合計値が大きい方、それも同じ場合は役を先に作ったプレイヤーがフラッグを獲得します。また、自分のターンの終了時に、自分の役が成立しているフラッグは、相手の役が未成立であっても、相手がフラッグを獲得できないことを場札から証明できれば（システムが自動で判断して）フラッグ獲得となります。

![フラッグの獲得](./images/getting-flags.jpg)

このフラッグを、合計で5つ、もしくは、連続した3つを先に獲得したプレイヤーの勝ちです。

![勝利条件](./images/win-1.jpg)
![勝利条件](./images/win-2.jpg)

[課題確認](./front-line/dist/index.html)で実際にプレイしていただくことで、ルールの理解が捗ると考えます。プレイしてみてください。

## 作成していただくプログラムの仕様

プログラムは、手札や場の状態を標準入力から受信し、どのような行動をするかを標準出力に送信してください。フォーマットはJSONで、1つのデータを1行で表現します。

通信は、ゲーム開始時、ターンが回ってきたとき（カードを出せない場に時は、ターンが飛ばされます）、ゲーム終了時の3種類が有ります。

### ゲーム開始時

入力として`{"command":"initialize"}`が渡ってきます。初期化処理が完了したら、JSON形式のデータを何か（`"OK"`等）出力してください。

### ターンが回ってきたとき

入力として、以下のUMLで表現する情報がJSONで渡ってきます。

![入力]()

出力は、以下のUMLで表現する情報をJSON形式で出力してください。

![出力]()

### ゲーム終了時

入力として`{"command":"finalize"}`が渡ってきます。終了処理が完了したら、JSON形式のデータを何か（`"OK"`等）出力してください。

### 注意点

* 乱数シードが同じであれば同じカードが配られることの活用（最初に配られたカードから乱数シードを推測し、相手の手札や山札を予測する等）は禁止とします。
* 不正なJSONを送付するプログラムは失格となります。
* ターンが回ってきたときにルールで許されていない手が出力されたときは、そのゲームは負けとなります。
* 対戦は、OSがWindows 11 Professional 64bit、CPUがIntel Core i7-1165G7、メモリが32GBの環境で実施します。自分のプログラムに加えて相手のプログラムも実行しますので、メモリを使用しすぎないようにしてください。
* ゲーム開始時とゲーム終了時の処理は概ね30秒以内、ターンが回ってきた時の処理は概ね10秒以内に完了させてください。
* ログ出力は、標準エラー出力を使用してください。
* プログラムを作成する際は、[サンプル](./python-example.zip)や[課題確認（ソース・コード）](./front-line.zip)のsrc/cli/adapter.jsとsrc/players/operation*.jsを参考にしてみてください。

## 対戦環境

対戦環境は、[課題確認（ソース・コード）](./front-line.zip)で提供しています。プログラミング言語はJavaScriptで、[node.js](https://nodejs.org/ja)上で動作します。

node.jsをインストール（18.16.0 LTSで動作検証しています）し、アーカイブを適当なフォルダに展開し、そのフォルダで`npm install`してください。

### コマンドライン上でのAI同士の対戦

AI同士を対戦させる場合は、`npm --silent run play "先攻プレイヤーを起動するコマンド" "後攻プレイヤーを起動するコマンド" 乱数シード`を実行してください。乱数シードを0にした場合は、対戦環境がランダムにシードを選択します。

![AI対戦の起動](./images/npm-run-play-1.png)

![AI対戦の結果](./images/npm-run-play-2.png)

ゲームの途中経過やAIのログは標準エラー出力に、ゲームの結果は標準出力に出力されます。標準出力に出力されるゲームの結果は、先攻が勝った場合は「0」、後攻が勝った場合は「1」です。

### Webブラウザ上での作成したAIと人の対戦

作成したAIとWebブラウザ上で対戦することもできます。準備として、コマンドプロンプトを2つ開いて、1つ目のコマンドプロンプトで`npm run dev`した上で、2つ目のコマンドプロンプトで`npm run webSocke "AIを起動するコマンド"`を実行してください。

![npm run dev](./images/npm-run-dev.png)

![npm run webSocket](./images/npm-run-webSocket.png)

その上で、`npm run dev`したコマンドプロンプトに表示されたアドレスをWebブラウザで開き、\[敵\]セレクトボックスを「WebSocket」に設定し、\[New Game\]ボタンをクリックしてください。

![作成したAIと対戦](./images/play-with-ai.png)

## コンクールの進行

練習試合と公式試合を、それぞれ1回実施します。

練習試合の形式は、乱数シードを固定しての、先攻と後攻を入れ替えての2対戦を単位にした総当り戦です。これを72時間で繰り返せるだけ繰り返して、勝利数で順位をつけます。

公式試合では、予選として練習試合と同形式の試合を実施し、上位4名を決定します。この4名での総当たり戦の決勝を24時間実施し、順位を決定します。決勝で同着が発生した場合は直接対戦での勝利数が多い方、勝利数が同じ場合は追加で先攻と後攻を入れ替えての対戦を実施して勝利が多い方を、それも同じ場合は、処理時間が短かった方を上位とします。

## コミュニケーション

プログラミング・コンクールの目的は「NULグループにおける開発力の向上および、参加者どうしの相互啓発を図る」です。

課題のポイントを理解し、ポイントに沿う形で自身の作品の優秀さを主張してください。プログラミング・コンクールに参加する人と作品に敬意を払い、理解しあい、互いの優秀なスキルを共有してください。

参加者全員が「相互啓発を図る」ために、課題についての質問や意見は参加者全員で対応することとします。参加者は以下の事項を守ってください。

1. 課題についての質問は、後述するTeamsに投稿/回答してください。
2. 質問や回答に意見のある場合も、Teamsを使用してください。個人宛ての質問や意見は不可とします。

## Teams

コミュニケーション媒体としてTeamsに「プロコン参加者サイト」チームを用意しますので、ご活用ください。「◯◯技術についてオブザーバーが解説しろ」とかの投稿でも大丈夫です。ただ、オブザーバーの能力不足で解説できない場合は、申し訳有りません、相互啓発ということで参加者の皆様のご協力をお願いするかもしれません。

1. 事務局が、参加者とオブザーバーをメンバー登録します。メンバーは、課題1と課題2のどちらのチャンネルにも参加することができます。
2. 各課題の質問や連絡は各課題のチャンネルに投稿してください。
3. 投稿するとき、「@」を付けてメンションするとメンバーに通知することができます。「@q1」は課題1のメンバー全員に、「@q2」は課題2のメンバー全員にメンションが届きます。
4. 過去の投稿は遡って確認できます。途中から参加した方は、過去の投稿も確認するようにしてください。
